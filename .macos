#!/usr/bin/env bash

# include colorized echo
# shellcheck disable=SC1090
source "${HOME}/Projects/dotfiles/bin/echos.sh"

# Start
bot "Starting $(basename "$0")"

# Ask for the administrator password upfront
sudo -v

# Keep-alive: update existing `sudo` time stamp until `.macos` has finished
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

########################################    #######################################
# General System
###############################################################################
running "Set computer name (as done via System Preferences → Sharing)"
read -r -p "Please enter new hostname _: " _hn

sudo scutil --set ComputerName "$_hn"
sudo scutil --set HostName "$_hn"
sudo scutil --set LocalHostName "$_hn"
sudo defaults write /Library/Preferences/SystemConfiguration/com.apple.smb.server NetBIOSName -string "$_hn"
ok

###############################################################################
# Address Book, Dashboard, iCal, TextEdit, and Disk Utility                   #
###############################################################################

running "Start week on Monday"
defaults write com.apple.ical "first day of the week" 1
ok

###############################################################################
# Photos                                                                      #
###############################################################################

running "Prevent Photos from opening automatically when devices are plugged in"
defaults -currentHost write com.apple.ImageCapture disableHotPlug -bool true
ok

###############################################################################
# Firewall
###############################################################################

running "Enable the firewall"
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setglobalstate on
ok

running "Enable stealth mode"
sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setstealthmode on
ok

###############################################################################
# Dock, Dashboard, and hot corners
###############################################################################

running "Top right screen corner → Put display to sleep"
# Hot corners:
# Possible values:
#  0: no-op
#  2: Mission Control
#  3: Show application windows
#  4: Desktop
#  5: Start screen saver
#  6: Disable screen saver
#  7: Dashboard
# 10: Put display to sleep
# 11: Launchpad
# 12: Notification Center
defaults write com.apple.dock wvous-tr-corner -int 5
defaults write com.apple.dock wvous-tr-modifier -int 0
ok

###############################################################################
# TextEdit
###############################################################################

running "TexEdit: Use plain text mode for new TextEdit documents"
defaults write com.apple.TextEdit RichText -int 0
ok

running "TexEdit: Open and save files as UTF-8 in TextEdit"
defaults write com.apple.TextEdit PlainTextEncoding -int 4
defaults write com.apple.TextEdit PlainTextEncodingForWrite -int 4
ok

# Finished
bot "$(basename "$0") complete."
